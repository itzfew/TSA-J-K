<!DOCTYPE html>
<html lang="en">
  <head>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <!-- Page intro for Search Engine and social media -->
    <link rel="icon" type="image/png" href="viewicon.png" />
    <meta property="og:type" content="website" />
    <meta
      property="og:title"
      content="View Counter Made With Firebase Database."
    />
    <meta
      property="og:description"
      content="Extremely fast and easily coded views counter made with pure JavaScript and Firebase."
    />
    <meta
      property="og:image"
      content="https://www.mutualfilesharing.com/viewiconfbb7.png"
    />
    <meta
      name="description"
      content="The most easy-to-code views counter, Pure JavaScript that counts real views using Firebase database."
    />
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Views Counter</title>
    <!-- Firebase Script -->
    <script src="https://www.gstatic.com/firebasejs/4.13.0/firebase.js"></script>
    <script>
      // Initialize Firebase
      var config = {
  apiKey: "AIzaSyAAYFrQ4la9wDoFYF6IAauti_DBouzWlGM",
  authDomain: "friendship-checking.firebaseapp.com",
  databaseURL: "https://friendship-checking-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "friendship-checking",
  storageBucket: "friendship-checking.appspot.com",
  messagingSenderId: "118314602222",
  appId: "1:118314602222:web:38a71de7c01442821aadff",
  measurementId: "G-8Q6PZYQSBW"
};
  

      firebase.initializeApp(config);
    </script>
    <style>
      body {
        font-family: Arial, sans-serif;
        text-align: center;
        padding: 20px;
        background-color: #f4f4f9;
      }
      #loading {
        font-size: 18px;
        color: #555;
      }
      #viewdiv {
        font-size: 20px;
        color: #333;
      }
      #views {
        font-size: 40px;
        color: #007bff;
      }
    </style>
  </head>
  <body>
    <div id="parentdiv">
      <div id="loading">Loading, please wait...</div>
      <div id="viewdiv" style="display: none;">
        This page has been viewed <h1 id="views"></h1> times.
      </div>
    </div>
    <script>
      const countview = async () => {
        try {
          // Fetch user data  
          const ipinfo = await fetch('https://ipinfo.io/json').then(response => response.json());
          const { ip: userIp, country, city } = ipinfo;
 
          // Process user IP
          const userIpString = userIp.replace(/\./g, "x");
 
          // Reference to Firebase views
          const viewsRef = firebase.database().ref('views');

          // Retrieve views data once
          const snapshot = await viewsRef.once("value");

          // Update DOM elements
          document.getElementById("loading").style.display = "none";
          document.getElementById("viewdiv").style.display = "block";
          document.getElementById("views").innerHTML = snapshot.numChildren();

          // Check if user IP is already recorded
          if (snapshot.hasChild(userIpString)) {
            console.log("View will not count, this is a returning user.");
          } else {
            // Record new user details
            const userDetails = { country, UserIP: userIp, city };
            await viewsRef.child(userIpString).set(userDetails);
            console.log("View counted, looks like a new user.");
          }
        } catch (error) {
          console.error("Error fetching user data or interacting with Firebase:", error);
        }
      };

      countview();
    </script>
  </body>
</html>
