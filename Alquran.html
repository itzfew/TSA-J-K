<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Quran Viewer</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      font-family: 'Arial', sans-serif;
      margin: 0;
      background-color: #fff;
      padding: 0;
      direction: ltr;
    }

    h1 {
      text-align: center;
      color: #333;
      font-size: 28px;
      margin-bottom: 20px;
      font-family: 'Arial', sans-serif;
    }

    #ayahs {
      padding: 20px;
    }

    .ayah-container {
      margin-bottom: 25px;
    }

    .ayah-container div {
      margin-bottom: 5px;
    }

    .ayah-container p {
      font-size: 20px;
      line-height: 1.6;
      margin: 0;
      font-family: 'Traditional Arabic', serif;
    }

    .ayah-container p.arabic {
      font-size: 39px;
      font-family: 'Amiri', serif;
      direction: rtl;
    }

    .ayah-container p.english,
    .ayah-container p.urdu {
      font-size: 13px;
      font-family: 'Tahoma', sans-serif;
      color: #555;
    }

    .ayah-container hr {
      border: 1px solid #ccc;
      margin: 10px 0;
    }

    .navigation {
      text-align: center;
      margin-top: 20px;
    }

    button {
      padding: 10px 15px;
      background-color: #4CAF50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 16px;
    }

    button:hover {
      background-color: #45a049;
    }

    .settings-container {
      position: fixed;
      top: 0;
      right: -100%;
      width: 300px;
      height: 100%;
      background-color: #f9f9f9;
      box-shadow: -4px 0 6px rgba(0, 0, 0, 0.3);
      padding: 20px;
      transition: right 0.3s ease;
      z-index: 1000;
    }

    .settings-container.show {
      right: 0;
    }

    label {
      display: block;
      font-size: 16px;
      margin-bottom: 10px;
      color: #333;
    }

    .select-container {
      width: 100%;
      margin: 10px 0;
    }

    select {
      width: 100%;
      padding: 10px;
      font-size: 16px;
      border-radius: 5px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
      cursor: pointer;
    }

    .settings button {
      margin-top: 10px;
      background-color: #007BFF;
    }

    .settings button:hover {
      background-color: #0056b3;
    }

    .settings-button {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: #007BFF;
      padding: 10px 15px;
      border-radius: 50%;
      color: white;
      border: none;
      cursor: pointer;
      z-index: 1001;
    }

    .settings-button:hover {
      background-color: #0056b3;
    }

    .settings-button i {
      font-size: 20px;
    }
  </style>
</head>
<body>

  <h1>Quran Page Viewer</h1>

  <div id="ayahs">
    <!-- Ayah content will be displayed here -->
  </div>

  <div class="navigation">
    <button onclick="navigateToPage('prev')">Previous</button>
    <button onclick="navigateToPage('next')">Next</button>
  </div>

  <button class="settings-button" onclick="toggleSettings()">
    <i class="fa fa-cog"></i>
  </button>

  <div class="settings-container" id="settingsContainer">
    <button onclick="toggleSettings()" class="close-btn">
      <i class="fa fa-times"></i>
    </button>
    <h2>Settings</h2>

    <label for="languageSelect">Select Languages:</label>
    <div class="select-container">
      <select id="languageSelect" multiple onchange="updateIdentifiers()">
        <!-- Languages will be dynamically added here -->
      </select>
    </div>

    <label for="identifierSelect">Select Identifiers:</label>
    <div class="select-container">
      <select id="identifierSelect" multiple>
        <!-- Identifiers will be dynamically added here -->
      </select>
    </div>

    <button onclick="applySettings()">Apply</button>
  </div>

<script>
  let currentPage = 1;
  let selectedLanguages = ["ar", "en", "ur"]; // Default languages
  let selectedIdentifiers = ["ar.quran-uthmani", "en.ahmedraza", "ur.qadri"]; // Default identifiers

  // Function to get the page index from the URL
  function getPageFromUrl() {
    const params = new URLSearchParams(window.location.search);
    return parseInt(params.get('index'), 10) || 1;  // Defaults to page 1 if 'index' is not in URL
  }

  // Function to update the URL with the new page index
  function updateUrl(index) {
    const newUrl = `${window.location.origin}${window.location.pathname}?index=${index}`;
    history.pushState({}, '', newUrl);
  }

  // Function to fetch data for the selected page
  async function fetchData(page, identifiers) {
    const promises = identifiers.map(identifier =>
      fetch(`https://api.alquran.cloud/v1/page/${page}/${identifier}`).then(response => response.json())
    );
    const results = await Promise.all(promises);
    return results.map(result => ({ translation: result.data.edition.identifier, ayahs: result.data.ayahs }));
  }

  // Function to display the ayahs on the page with identifier and language
  function displayAyahs(data) {
    const ayahContainer = document.getElementById('ayahs');
    ayahContainer.innerHTML = '';

    const ayahCount = data[0].ayahs.length;
    for (let i = 0; i < ayahCount; i++) {
      const ayahElement = document.createElement('div');
      ayahElement.classList.add('ayah-container');

      data.forEach(translationData => {
        const ayah = translationData.ayahs[i];
        let langClass = '';
        let identifierName = '';

        // Assigning a language class and identifier name based on translationData
        if (translationData.translation === 'ar.quran-uthmani') {
          langClass = 'arabic';
          identifierName = 'Arabic (Uthmani)';
        } else if (translationData.translation === 'en.ahmedraza') {
          langClass = 'english';
          identifierName = 'English (Ahmed Raza)';
        } else if (translationData.translation === 'ur.qadri') {
          langClass = 'urdu';
          identifierName = 'Urdu (Qadri)';
        }

        // Constructing HTML to display the verse with identifier and language
        ayahElement.innerHTML += `
          <div>
            <p class="${langClass}">
              <strong>(${identifierName}):</strong> ${ayah.text}
            </p>
          </div>
        `;
      });

      ayahElement.innerHTML += '<hr />';
      ayahContainer.appendChild(ayahElement);
    }
  }

  // Function to load the page with the specified index
  async function loadPage(page) {
    const data = await fetchData(page, selectedIdentifiers);
    displayAyahs(data);
  }

  // Function to handle page navigation (prev/next)
  function changePage(direction) {
    let currentPage = getPageFromUrl();
    if (direction === 'prev' && currentPage > 1) currentPage--;
    if (direction === 'next') currentPage++;
    updateUrl(currentPage);
    loadPage(currentPage);
  }

  // Page load handling
  window.onload = () => {
    currentPage = getPageFromUrl();  // Get page index from URL
    loadPage(currentPage);  // Load page content based on the index
  };

  // Function to toggle the settings sidebar
  function toggleSettings() {
    const settingsContainer = document.getElementById('settingsContainer');
    settingsContainer.classList.toggle('show');
  }

  // Fetch languages and identifiers for settings
  async function fetchLanguages() {
    const languagesResponse = await fetch('https://api.alquran.cloud/v1/edition/language');
    const languagesData = await languagesResponse.json();

    const languageSelect = document.getElementById('languageSelect');
    languageSelect.innerHTML = languagesData.data.map(lang => `
      <option value="${lang}" ${selectedLanguages.includes(lang) ? 'selected' : ''}>${lang}</option>
    `).join('');

    updateIdentifiers();
  }

  // Update the list of available identifiers based on selected languages
  async function updateIdentifiers() {
    const languageSelect = document.getElementById('languageSelect');
    selectedLanguages = Array.from(languageSelect.selectedOptions).map(option => option.value);

    const promises = selectedLanguages.map(language =>
      fetch(`https://api.alquran.cloud/v1/edition/language/${language}`).then(response => response.json())
    );
    const results = await Promise.all(promises);

    const identifiers = results.flatMap(result => result.data.filter(trans => trans.format === 'text').map(trans => ({
      identifier: trans.identifier,
      name: `${trans.englishName} (${trans.language})`
    })));

    const identifierSelect = document.getElementById('identifierSelect');
    identifierSelect.innerHTML = identifiers.map(identifier => `
      <option value="${identifier.identifier}" ${selectedIdentifiers.includes(identifier.identifier) ? 'selected' : ''}>
        ${identifier.name}
      </option>
    `).join('');
  }

  // Apply the selected settings
  function applySettings() {
    const identifierSelect = document.getElementById('identifierSelect');
    selectedIdentifiers = Array.from(identifierSelect.selectedOptions).map(option => option.value);
    toggleSettings();
    loadPage(currentPage);
  }

  // Fetch languages and load initial page
  fetchLanguages();
  loadPage(currentPage);
</script>

</body>
</html>
